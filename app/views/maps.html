{% extends "layout.html" %}

{% block page_title %}Graphs - FIS Prototype - GOV.UK{% endblock %}

{% block head %}
  {% include "partials/head.html" %}
  {% include "partials/snippets_head.html" %}
  <!--<link rel="stylesheet" href="https://openlayers.org/en/v3.19.1/css/ol.css" type="text/css">-->
  <link rel="stylesheet" href="/public/stylesheets/vendor/ol.css" type="text/css">
  <script src="https://openlayers.org/en/v3.19.1/build/ol.js" type="text/javascript"></script>
{% endblock %}

{% block content %}

<main id="content" role="main" tabindex="-1">

	{% include "partials/phase_banner.html" %}
	{% include "partials/breadcrumb.html" %}

	<div class="grid-row">

		<div class="column-two-thirds">

			<h1 class="heading-xlarge">
				<span class="heading-secondary">FIS Prototype</span>
				Maps
			</h1>

		</div>

	</div>

	<div class="grid-row">

		<div class="column-two-thirds">

			<section aria-labelledby="flood-warning-area" role="region">

				<h2 id="flood-warning-area" class="heading-medium">
					Warning or severe warning
				</h2>       

				<div class="map" id="map"></div>


				<h2 id="flood-alert-area" class="heading-medium">
					Alert
				</h2>       

				<div class="map" id="map-b"></div>
				
				<h2 id="flood-warning-area" class="heading-medium">
					Warning no longer in force
				</h2>       

				<div class="map" id="map-c"></div>

			</section>

		</div>

	</div>

</main>

{% endblock %}

{% block body_end %}
  <!-- GOV.UK elements redirect -->
  <!--<script src="/public/javascripts/redirect.js"></script>-->
  {% include "partials/scripts.html" %}

  <!-- Open layers -->
  <!-- Below is for visual and interaction reference only -->
  <!-- Will need to be converted to production code -->

	<script type="text/javascript">

		var geoJSON1 = '/public/javascripts/json/061waf06Coln.json';
		var geoJSON2 = '/public/javascripts/json/061fwf23CalcLech.json';

		//
		//
		// Styles
		//
		//

		// Higlighted style displays a 4px border to the outside of the target area
		var styleSelectedBg = new ol.style.Style({
			stroke: new ol.style.Stroke({ color: 'rgb(255,170,0)', width: 8, miterLimit: 2, lineJoin: 'round' }), zIndex: 1,
			fill: new ol.style.Fill({ color: 'rgb(255,170,0)', miterLimit: 2, lineJoin: 'round' })
		});

		// Visual representation only: Used to maintain colour consistent with non-highligthed areas
		var styleBg = new ol.style.Style({
			stroke: new ol.style.Stroke({ color: 'rgb(255,170,0)', width: 1, miterLimit: 2, lineJoin: 'round' }), zIndex: 1,
			fill: new ol.style.Fill({ color: 'rgb(255,170,0)', miterLimit: 2, lineJoin: 'round' })
		});

		// Warning

		var styleWarning = new ol.style.Style({
			fill: new ol.style.Fill({ color: 'rgba(230,8,13,1)', miterLimit: 2, lineJoin: 'round' }),			
			stroke: new ol.style.Stroke({ color: 'rgba(230,8,13,1)', width: 2, miterLimit: 2, lineJoin: 'round' }), zIndex: 1
		});

		// Alert

		var styleAlert = new ol.style.Style({
			fill: new ol.style.Fill({ color: '#e06b00' }),			
			stroke: new ol.style.Stroke({ color: '#e06b00', width: 2, miterLimit: 2, lineJoin: 'round' }), zIndex: 1
		});

		// Warning no longer in force (Removed)

		var styleRemoved = new ol.style.Style({
			fill: new ol.style.Fill({ color: 'rgb(123,123,123)' }),			
			stroke: new ol.style.Stroke({ color: 'rgb(123,123,123)', width: 2, miterLimit: 2, lineJoin: 'round' }), zIndex: 1
		});
		
		
		//
		//
		// Warning or sever warning map
		//
		//

		var title = new ol.layer.Tile({
			source: new ol.source.OSM()
		});

		var area1 = new ol.layer.Vector({
			source: new ol.source.Vector({
				format: new ol.format.GeoJSON(),
				url: geoJSON2,
				defaultProjection :'EPSG:4326', 
				projection: 'EPSG:3857'
			}),
			style: [styleBg, styleWarning],
			opacity: 0.75
		});

		var area2 = new ol.layer.Vector({
			source: new ol.source.Vector({
				format: new ol.format.GeoJSON(),
				url: geoJSON1,
				defaultProjection :'EPSG:4326', 
				projection: 'EPSG:3857'
			}),
			style: [styleSelectedBg, styleWarning],
			opacity: 0.75,
			zIndex: 1
		});

		var map = new ol.Map({
			target: 'map',
			layers: [title, area1, area2],
			view: new ol.View({
				center: ol.proj.fromLonLat([-1.83,51.77]),
				zoom: 10
			})
		});

		// Enable transparency above zoom level of 10
		// With a solid fill at small zoom levels target areas are easier to identify and select

		map.on('moveend', function (e){
			if (map.getView().getZoom() >= 11) {
				map.on('precompose', function (e){
					e.context.globalCompositeOperation = 'darken';
				});
			}
			else {
				map.on('precompose', function (e){
					e.context.globalCompositeOperation = 'source-over';
				});
			};
		});

		// Change pointer type and highlight style
		map.on('pointermove', function (e) {

			var pixel = map.getEventPixel(e.originalEvent);
			var hit = map.hasFeatureAtPixel(pixel);
			map.getViewport().style.cursor = hit ? 'pointer' : '';

		});


		//
		//
		// Alert map
		//
		//

		var title = new ol.layer.Tile({
			source: new ol.source.OSM()
		});

		var area1B = new ol.layer.Vector({
			source: new ol.source.Vector({
				format: new ol.format.GeoJSON(),
				url: geoJSON2,
				defaultProjection :'EPSG:4326', 
				projection: 'EPSG:3857'
			}),
			style: [styleBg, styleAlert],
			opacity: 0.75
		});

		var area2B = new ol.layer.Vector({
			source: new ol.source.Vector({
				format: new ol.format.GeoJSON(),
				url: geoJSON1,
				defaultProjection :'EPSG:4326', 
				projection: 'EPSG:3857'
			}),
			style: [styleSelectedBg, styleAlert],
			opacity: 0.75,
			zIndex: 1
		});

		var mapB = new ol.Map({
			target: 'map-b',
			layers: [title, area1B, area2B],
			view: new ol.View({
				center: ol.proj.fromLonLat([-1.83,51.77]),
				zoom: 10
			})
		});

		// Enable transparency above zoom level of 10
		// With a solid fill at small zoom levels target areas are easier to identify and select
		mapB.on('moveend', function (e){
			if (mapB.getView().getZoom() >= 11) {
				mapB.on('precompose', function (e){
					e.context.globalCompositeOperation = 'darken';
				});
			}
			else {
				mapB.on('precompose', function (e){
					e.context.globalCompositeOperation = 'source-over';
				});
			};
		});

		// Change pointer type and highlight style
		mapB.on('pointermove', function (e) {

			var pixel = mapB.getEventPixel(e.originalEvent);
			var hit = mapB.hasFeatureAtPixel(pixel);
			mapB.getViewport().style.cursor = hit ? 'pointer' : '';

		});


		//
		//
		// Warning no longer inforce map
		//
		//
		
		var title = new ol.layer.Tile({
			source: new ol.source.OSM()
		});

		var area1C = new ol.layer.Vector({
			source: new ol.source.Vector({
				format: new ol.format.GeoJSON(),
				url: geoJSON2,
				defaultProjection :'EPSG:4326', 
				projection: 'EPSG:3857'
			}),
			style: [styleBg, styleRemoved],
			opacity: 0.75
		});

		var area2C = new ol.layer.Vector({
			source: new ol.source.Vector({
				format: new ol.format.GeoJSON(),
				url: geoJSON1,
				defaultProjection :'EPSG:4326', 
				projection: 'EPSG:3857'
			}),
			style: [styleSelectedBg, styleRemoved],
			opacity: 0.75,
			zIndex: 1
		});

		var mapC = new ol.Map({
			target: 'map-c',
			layers: [title, area1C, area2C],
			view: new ol.View({
				center: ol.proj.fromLonLat([-1.83,51.77]),
				zoom: 10
			})
		});

		// Enable transparency above zoom level of 10
		// With a solid fill at small zoom levels target areas are easier to identify and select
		mapC.on('moveend', function (e){
			if (mapC.getView().getZoom() >= 11) {
				mapC.on('precompose', function (e){
					e.context.globalCompositeOperation = 'darken';
				});
			}
			else {
				mapC.on('precompose', function (e){
					e.context.globalCompositeOperation = 'source-over';
				});
			};
		});

		// Change pointer type and highlight style
		mapC.on('pointermove', function (e) {

			var pixel = mapC.getEventPixel(e.originalEvent);
			var hit = mapC.hasFeatureAtPixel(pixel);
			mapC.getViewport().style.cursor = hit ? 'pointer' : '';

		});

	</script>

	<!-- / Visual and interaction reference -->
	<!-- / Open layers -->
{% endblock %}